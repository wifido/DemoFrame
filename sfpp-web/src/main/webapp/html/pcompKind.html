<!DOCTYPE html>
<html lang="en" class="app">
<head>
    <meta charset="utf-8"/>
    <title></title>
    <meta name="description"
          content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <link rel="stylesheet" href="js/jPlayer/jplayer.flat.css" type="text/css"/>
    <link rel="stylesheet" href="css/bootstrap.css" type="text/css"/>
    <link rel="stylesheet" href="css/animate.css" type="text/css"/>
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css"/>
    <link rel="stylesheet" href="css/simple-line-icons.css" type="text/css"/>
    <link rel="stylesheet" href="css/font.css" type="text/css"/>
    <link rel="stylesheet" href="css/app.css" type="text/css"/>
    <link rel="stylesheet" href="css/editormd.min.css" type="text/css"/>
    <link rel="stylesheet" href="plugins/jQueryUI/jquery-ui.min.css" type="text/css"/>
    <link rel="stylesheet" href="plugins/bootstrap3-fileinput/css/fileinput.min.css" type="text/css"/>

    <link rel="stylesheet" href="css/customize.css" type="text/css"/>
    <!--[if lt IE 9]>
    <script src="js/ie/html5shiv.js"></script>
    <script src="js/ie/respond.min.js"></script>
    <script src="js/ie/excanvas.js"></script>
    <![endif]-->
</head>
<body class="">
<section class="vbox">
    <header class="bg-white-only header header-md navbar navbar-fixed-top-xs">
        <div class="navbar-header aside bg-info ">
            <a class="btn btn-link visible-xs" data-toggle="class:nav-off-screen,open" data-target="#nav,html">
                <i class="icon-list"></i>
            </a>
            <a href="index.html" class="navbar-brand text-lt">
                <i class="icon-folder"></i>
                <span class="hidden-nav-xs m-l-sm">SFPP</span>
            </a>
            <a class="btn btn-link visible-xs" data-toggle="dropdown" data-target=".user">
                <i class="icon-settings"></i>
            </a>
        </div>
        <ul class="nav navbar-nav hidden-xs">
            <li>
                <a href="#nav,.navbar-header" data-toggle="class:nav-xs,nav-xs" class="text-muted active">
                    <i class="fa fa-indent text"></i>
                    <i class="fa fa-dedent text-active"></i>
                </a>
            </li>
        </ul>
        <form class="navbar-form navbar-left input-s-lg m-t m-l-n-xs hidden-xs" role="search">
            <div class="form-group">
                <div class="input-group">
            <span class="input-group-btn">
              <button type="submit" class="btn btn-sm bg-white btn-icon rounded"><i class="fa fa-search"></i></button>
            </span>
                    <input type="text" class="form-control input-sm no-border rounded"
                           placeholder="搜索本站">
                </div>
            </div>
        </form>
        <div class="navbar-right ">
            <ul class="nav navbar-nav m-n hidden-xs nav-user user">

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle bg clear" data-toggle="dropdown">
              <span class="thumb-sm avatar pull-right m-t-n-sm m-b-n-sm m-l-sm">
                <img src="images/a0.png" alt="...">
              </span>
                        <userNo></userNo>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu animated fadeInRight">
                        <li>
                            <a href="../logout">Logout</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </header>
    <section>
        <section class="hbox stretch">
            <!-- .aside -->
            <aside class="bg-black dk aside hidden-print" id="nav">
                <section class="vbox">
                    <section class="w-f-md scrollable">
                        <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0"
                             data-size="10px" data-railOpacity="0.2">


                            <!-- nav -->
                            <nav class="nav-primary hidden-xs">
                                <ul class="nav bg clearfix">
                                    <li class="hidden-nav-xs padder m-t m-b-sm text-xs text-muted">
                                        版块
                                    </li>
                                    <li>
                                        <a href="index.html" data-transition="pop">
                                            <i class="icon-home icon text-success"></i>
                                            <span class="font-bold">主页</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="internal.html" data-transition="pop">
                                            <i class="icon-grid icon text-info"></i>
                                            <span class="font-bold">内部组件</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="pcompTitle.html" data-transition="pop">
                                            <i class="icon-drawer icon text-primary-lter"></i>
                                            <span class="font-bold">开放软件</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-transition="pop">
                                            <i class="icon-list icon  text-info-dker"></i>
                                            <span class="font-bold">技术学院</span>
                                        </a>
                                    </li>
                                    <li class="m-b hidden-nav-xs"></li>
                                </ul>
                            </nav>
                            <!-- / nav -->
                        </div>
                    </section>
                </section>
            </aside>
            <!-- /.aside -->
            <section id="content">
                <section class="hbox stretch">
                    <section>
                        <section class="vbox">
                            <section class="scrollable padder-lg w-f-md" id="bjax-target">
                                <a href="#" class="pull-right text-muted m-t-lg" id="refreshPcompKindAllSoftwares"><i
                                        class="icon-refresh i-lg  inline"></i></a>

                                <h2 class="font-thin m-b" id="pcompKindAllSoftwaresTitle">
                                    <pcompKindAllSoftwaresTitle></pcompKindAllSoftwaresTitle>

                                    <span class="musicbar animate inline m-l-sm" style="width:20px;height:20px">
                                        <span class="bar1 a1 bg-primary lter"></span>
                                        <span class="bar2 a2 bg-info lt"></span>
                                        <span class="bar3 a3 bg-success"></span>
                                        <span class="bar4 a4 bg-warning dk"></span>
                                        <span class="bar5 a5 bg-danger dker"></span>
                                    </span>
                                    </span></h2>

                                <div class="row row-sm">
                                    <pcompKindAllSoftwares></pcompKindAllSoftwares>

                                </div>
                                <div class="row row-sm">
                                    <div class="text-center">
                                        <ul class="pagination pagination" id="pcompKindAllSoftwaresPagination">
                                        </ul>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-7">
                                        <a href="#" class="pull-right text-muted m-t-lg"
                                           id="refreshPcompKindLatestSoftwares">
                                            <i class="icon-refresh i-lg  inline"></i></a>

                                        <h3 class="font-thin">
                                            <pcompKindLatestSoftwaresTitle></pcompKindLatestSoftwaresTitle>

                                            <span class="musicbar animate inline m-l-sm" style="width:20px;height:20px">
                                                <span class="bar1 a1 bg-primary lter"></span>
                                                <span class="bar2 a2 bg-info lt"></span>
                                                <span class="bar3 a3 bg-success"></span>
                                                <span class="bar4 a4 bg-warning dk"></span>
                                                <span class="bar5 a5 bg-danger dker"></span>
                                            </span>
                                        </h3>

                                        <div class="row row-sm">
                                            <pcompKindLatestSoftwares></pcompKindLatestSoftwares>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <a href="#" class="pull-right text-muted m-t-lg"
                                           id="refreshPcompKindHotestSoftwares"><i
                                                class="icon-refresh i-lg  inline"></i></a>

                                        <h3 class="font-thin">
                                            <pcompKindHotestSoftwaresTitle></pcompKindHotestSoftwaresTitle>
                                            <span class="musicbar animate inline m-l-sm" style="width:20px;height:20px">
                                                <span class="bar1 a1 bg-primary lter"></span>
                                                <span class="bar2 a2 bg-info lt"></span>
                                                <span class="bar3 a3 bg-success"></span>
                                                <span class="bar4 a4 bg-warning dk"></span>
                                                <span class="bar5 a5 bg-danger dker"></span>
                                              </span>
                                        </h3>

                                        <div class="list-group bg-white list-group-lg no-bg auto">
                                            <pcompKindHotestSoftwares></pcompKindHotestSoftwares>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </section>
                    </section>
                    <!-- / side content -->
                </section>
                <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen,open"
                   data-target="#nav,html"></a>
            </section>
        </section>
    </section>
</section>

<script src="js/jquery.min.js"></script>

<!-- Bootstrap -->
<script src="js/bootstrap.js"></script>
<!-- App -->
<script src="js/app.js"></script>
<script src="js/slimscroll/jquery.slimscroll.min.js"></script>
<script src="js/app.plugin.js"></script>
<script type="text/javascript" src="js/jPlayer/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="js/jPlayer/add-on/jplayer.playlist.min.js"></script>
<script type="text/javascript" src="js/jPlayer/demo.js"></script>

<script type="text/javascript" src="js/sfpp-native/util.js"></script>
<script type="text/javascript" src="js/sfpp-native/user.js"></script>
<script type="text/javascript" src="js/sfpp-native/pcomp.js"></script>
<script type="text/javascript" src="js/sfpp-native/pcompform.js"></script>
<script type="text/javascript" src="js/sfpp-native/search.js"></script>
<script type="text/javascript" src="js/editormd.min.js"></script>
<script src="js/jquery-form.js"></script>
<script src="js/ajaxfileupload.js"></script>
<script src="lib/raphael.min.js"></script>
<script src="lib/underscore.min.js"></script>
<script src="lib/sequence-diagram.min.js"></script>
<script src="lib/flowchart.min.js"></script>
<script src="lib/jquery.flowchart.min.js"></script>
<script src="lib/prettify.min.js"></script>
<script src="lib/marked.min.js"></script>
<script src="plugins/jQueryUI/jquery-ui.min.js"></script>
<script src="plugins/bootstrap3-fileinput/js/fileinput.min.js"></script>
<script>
    var pcompKindId = getUrlParam("pcompKindId");
    var pcompKind = $.pcomp.kind.getByKindId(pcompKindId);
    $(document).ready(function () {
        $("userNo").html(($.user.get()).userNo);
        displayPcompKindAllSoftwares(1);
        displayPcompKindLatestSoftwares();
        displayPcompKindHotestSoftwares();
        $("#refreshPcompKindAllSoftwares").click(
                function () {
                    $("#refreshPcompKindAllSoftwares").attr("class", "pull-right text-muted m-t-lg fa-spin");
                    displayPcompKindAllSoftwares(1);
                    setTimeout(function () {
                        $("#refreshPcompKindAllSoftwares").attr("class", "pull-right text-muted m-t-lg");
                    }, 1000);
                }
        );
        $("#refreshPcompKindLatestSoftwares").click(
                function () {
                    $("#refreshPcompKindLatestSoftwares").attr("class", "pull-right text-muted m-t-lg fa-spin");
                    displayPcompKindLatestSoftwares();
                    setTimeout(function () {
                        $("#refreshPcompKindLatestSoftwares").attr("class", "pull-right text-muted m-t-lg");
                    }, 1000);
                }
        );
        $("#refreshPcompKindHotestSoftwares").click(
                function () {
                    $("#refreshPcompKindHotestSoftwares").attr("class", "pull-right text-muted m-t-lg fa-spin");
                    displayPcompKindHotestSoftwares();
                    setTimeout(function () {
                        $("#refreshPcompKindHotestSoftwares").attr("class", "pull-right text-muted m-t-lg");
                    }, 1000);
                }
        );


        $("button[class*=btn][class*=btn-info][class*=btn-rounded]").click(function () {
            var dialogDiv = $("[role=dialog]");
            var id = this.id;
            dialogDiv.remove();
            var dialog = $(dialog_str);
            dialog.attr("title", "添加软件");
            var label = $("<h4></h4>");
            label.html("所属分类：<b>" + pcompKind.name + "</b>");
            dialog.append(label);
            label = $(label_str);
            label.html("请输入新软件名称（不为空）：");
            dialog.append(label);
            var softwareNameInput = $(pcomp_software_name_textInput_str);
            dialog.append(softwareNameInput);
            label = $(label_str);
            label.html("请为此软件上传一个头像（最好不为空）：");
            dialog.append(label);
            var File = $(notNull_fileInput_str);
            File.attr("name", "pcomp_software_avatar");
            File.attr("id", "pcomp_software_avatar");
            dialog.append(File);
            File.fileinput();
            label = $(label_str);
            label.html("请输入软件介绍：");
            dialog.append(label);
            var md = $(md_div);
            md.attr("id", "softwareIntroduction");
            dialog.append(md);
            dialog.dialog({
                autoOpen: false,
                minWidth: 800,
                minHeight: 600,
                maxHeight: 600,
                show: {effect: "blind", duration: 1000},
                hide: {effect: "explode", duration: 1000},
                modal: true,
                buttons: {
                    "提交修改": function () {
                        if (validatePcomp(pcompKind.id)) {
                            $.pcomp.software.add(pcompKind.id, softwareNameInput[0].value, mdEditorText.getMarkdown(), displayPcompKindAllSoftwares);
                            $(this).dialog("close");
                        }
                    },
                    "取消": function () {
                        $(this).dialog("close");
                    }
                }
            });
            dialog.dialog("open");
            var mdEditorText = editormd("softwareIntroduction", editorMdEditing);
        });

        function displayPcompKindLatestSoftwares() {
            var matrix_item_1 = "<div class=\"col-xs-6 col-sm-4 col-md-4 col-lg-4\" style='display: none'><div class=\"item\"><div class=\"pos-rlt\">";
            var matrix_item_2 = "<a href=\"";
            var matrix_item_3 = "\"><img src=\"";
            var matrix_item_4 = "\" alt=\"\" class=\"r r-2x img-full\"></a></div><div class=\"padder-v\"><a href=\"";
            var matrix_item_5 = "\" class=\"text-ellipsis\" style=\"text-align:center\">";
            var matrix_item_6 = "</a></div></div></div>";
            var html = "";
            $("pcompKindLatestSoftwaresTitle").html("本分类最新组件");
            var data = $.pcomp.software.getRecommendedByKind(pcompKindId);
            for (i = 0; i < data.length; i++) {
                html += matrix_item_1 + matrix_item_2 + getHtmlPath() + '/pcompSoftware.html?pcompSoftwareId=' + data[i].id + matrix_item_3 + data[i].avatar + matrix_item_4 + getHtmlPath() + '/pcompSoftware.html?pcompSoftwareId=' + data[i].id + matrix_item_5 + data[i].name + matrix_item_6;
            }
            $("pcompKindLatestSoftwares").html(html);
            var pcompSoftwareMatrixItem = $(".col-xs-6.col-sm-4.col-md-4.col-lg-4");
            for (i = 0; i < pcompSoftwareMatrixItem.length; i++) {
                var time = i * 500;
                if (time >= 5000) {
                    time = 5000;
                }
                $(pcompSoftwareMatrixItem[i]).fadeIn(time);
            }
        }

        function displayPcompKindHotestSoftwares() {
            var list_item_1 = "<a href=\"";
            var list_item_2 = "\" class=\"list-group-item clearfix\" style='display:none'><span class=\"pull-right h2 text-muted m-l\">";
            var list_item_3 = "</span><span class=\"pull-left thumb-sm avatar m-r\"><img src=\"";
            var list_item_4 = "\" alt=\"...\"></span><span class=\"clear\"><span>";
            var list_item_5 = "</span><small class=\"text-muted clear text-ellipsis\">";
            var list_item_6 = "</small></span></a>";
            $("pcompKindHotestSoftwaresTitle").html("本分类最火组件");
            var html = "";
            var data = $.pcomp.software.getHotByKind(pcompKindId);
            for (i = 0; i < data.length; i++) {
                var b = $.user.getUserInfo(data[i].createdBy);
                html += list_item_1 + getHtmlPath() + '/pcompSoftware.html?pcompSoftwareId=' + data[i].id + list_item_2 + (i + 1) + list_item_3 + data[i].avatar + list_item_4 + data[i].name + list_item_5 + b.userNo + list_item_6;
            }
            $("pcompKindHotestSoftwares").html(html);
            var pcompSoftwareListItem = $("a.list-group-item.clearfix");
            for (i = 0; i < pcompSoftwareListItem.length; i++) {
                var time = i * 500;
                if (time >= 5000) {
                    time = 5000;
                }
                $(pcompSoftwareListItem[i]).fadeIn(time);
            }
        }
    });

    function displayPcompKindAllSoftwares(pageNumber) {
        pcompKind = $.pcomp.kind.getByKindId(pcompKindId);
        $("title").html(pcompKind.name)
        var matrix_item_2 = "<a href=\"";
        var matrix_item_3 = "\"><img src=\"";
        var matrix_item_4 = "\" alt=\"\" class=\"r r-2x img-full\"></a></div><div class=\"padder-v\"><a href=\"";
        var matrix_item_5 = "\" class=\"text-ellipsis\" style=\"text-align:center\">";
        var matrix_item_6 = "</a></div></div></div>";
        var matrix_item_7 = "<div class=\"col-xs-6 col-sm-4 col-md-3 col-lg-2\" style='display: none'><div class=\"item\"><div class=\"pos-rlt\">";
        var html = "";
        var data;
        if (!isNull(pageNumber)) {
            data = $.pcomp.software.getAllByKind(pcompKindId, pageNumber);
        } else {
            data = $.pcomp.software.getAllByKind(pcompKindId, 1);
        }
        var list = data.list;
        for (i = 0; i < list.length; i++) {
            html += matrix_item_7 + matrix_item_2 + getHtmlPath() + '/pcompSoftware.html?pcompSoftwareId=' + list[i].id + matrix_item_3 + list[i].avatar + matrix_item_4 + getHtmlPath() + '/pcompSoftware.html?pcompSoftwareId=' + list[i].id +matrix_item_5 + list[i].name + matrix_item_6;
        }

        var titleHtml = "<img src=\"" + pcompKind.topPhoto + "\" style=\"width: 100%;max-width: 55px;height: auto;border-radius: 50%;padding: 5px\">" + pcompKind.name + "-全部组件";


        if ($.pcomp.userRight.getHasModifyKindRight(pcompKindId)) {
            titleHtml += "<button class='btn btn-success btn-rounded'>修改本分类</button><button class='btn btn-danger btn-rounded'>删除本分类</button>";
        }
        if ($.pcomp.userRight.getHasAddSoftwareRight(pcompKindId)) {
            titleHtml += "<button class='btn btn-info btn-rounded'>添加新开放软件</button>";
        }
        $("pcompKindAllSoftwaresTitle").html(titleHtml);
        $("pcompKindAllSoftwares").html(html);
        var pcompKindMatrixItem = $(".col-xs-6.col-sm-4.col-md-3.col-lg-2");
        for (i = 0; i < pcompKindMatrixItem.length; i++) {
            var time = i * 500;
            if (time >= 5000) {
                time = 5000;
            }
            $(pcompKindMatrixItem[i]).fadeIn(time);
        }
        html = "";
        for (i = data.firstPage; i <= data.lastPage; i++) {
            html += "<li ";
            if (i == data.pageNum) {
                html += "class='active'"
            }
            html += "><a onclick=\"displayPcompKindAllSoftwares(" + i + ")\">" + i + "</a></li>";
        }
        $("#pcompKindAllSoftwaresPagination").html(html);
        $("button[class*=btn][class*=btn-success][class*=btn-rounded]").click(function () {
            var dialogDiv = $("[role=dialog]");
            var id = this.id;
            dialogDiv.remove();
            var dialog = $(dialog_str);
            dialog.attr("title", "修改分类");
            label = $(label_str);
            label.html("请输入新分类名称（不为空）：");
            dialog.append(label);
            var kindNameInput = $(notNull_textInput_str);
            kindNameInput.attr("value", pcompKind.name);
            dialog.append(kindNameInput);
            label = $(label_str);
            label.html("请输入新分类简介（不为空）：");
            dialog.append(label);
            var notNullText = $(notNull_textInput_str);
            notNullText.attr("value", pcompKind.introduction);
            dialog.append(notNullText);
            label = $(label_str);
            label.html("请为此分类上传一个头像（留空为不修改）：");
            dialog.append(label);
            var File = $(fileInput_str);
            File.attr("name", "pcomp_kind_top_photo");
            File.attr("id", "pcomp_kind_top_photo");
            dialog.append(File);
            File.fileinput();
            dialog.dialog({
                autoOpen: false,
                minWidth: 400,
                minHeight: 400,
                show: {effect: "blind", duration: 1000},
                hide: {effect: "explode", duration: 1000},
                modal: true,
                buttons: {
                    "提交修改": function () {
                        if (validatePcomp()) {
                            $.pcomp.kind.update(pcompKind.id, kindNameInput[0].value, notNullText[0].value, displayPcompKindAllSoftwares);
                            $(this).dialog("close");
                        }
                    },
                    "取消": function () {
                        $(this).dialog("close");
                    }
                }
            });
            dialog.dialog("open");
        });
        $("button[class*=btn][class*=btn-danger][class*=btn-rounded]").click(function () {
            if (confirm("你确定要删除" + pcompKind.name + "吗？")) {
                $.pcomp.kind.remove(pcompKind.id)
            }
        });
    }
</script>
</body>
</html>