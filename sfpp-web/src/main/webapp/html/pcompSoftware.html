<!DOCTYPE html>
<html lang="en" class="app">
<head>
    <meta charset="utf-8"/>
    <title></title>
    <meta name="description"
          content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <link rel="stylesheet" href="js/jPlayer/jplayer.flat.css" type="text/css"/>
    <link rel="stylesheet" href="css/bootstrap.css" type="text/css"/>
    <link rel="stylesheet" href="css/animate.css" type="text/css"/>
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css"/>
    <link rel="stylesheet" href="css/simple-line-icons.css" type="text/css"/>
    <link rel="stylesheet" href="css/font.css" type="text/css"/>
    <link rel="stylesheet" href="css/app.css" type="text/css"/>
    <link rel="stylesheet" href="css/editormd.min.css" type="text/css"/>
    <link rel="stylesheet" href="plugins/jQueryUI/jquery-ui.min.css" type="text/css"/>
    <link rel="stylesheet" href="plugins/bootstrap3-fileinput/css/fileinput.min.css" type="text/css"/>

    <link rel="stylesheet" href="css/customize.css" type="text/css"/>
    <!--[if lt IE 9]>
    <script src="js/ie/html5shiv.js"></script>
    <script src="js/ie/respond.min.js"></script>
    <script src="js/ie/excanvas.js"></script>
    <![endif]-->
</head>
<body class="">
<section class="vbox">
    <header class="bg-white-only header header-md navbar navbar-fixed-top-xs">
        <div class="navbar-header aside bg-info ">
            <a class="btn btn-link visible-xs" data-toggle="class:nav-off-screen,open" data-target="#nav,html">
                <i class="icon-list"></i>
            </a>
            <a href="index.html" class="navbar-brand text-lt">
                <i class="icon-folder"></i>
                <span class="hidden-nav-xs m-l-sm">SFPP</span>
            </a>
            <a class="btn btn-link visible-xs" data-toggle="dropdown" data-target=".user">
                <i class="icon-settings"></i>
            </a>
        </div>
        <ul class="nav navbar-nav hidden-xs">
            <li>
                <a href="#nav,.navbar-header" data-toggle="class:nav-xs,nav-xs" class="text-muted active">
                    <i class="fa fa-indent text"></i>
                    <i class="fa fa-dedent text-active"></i>
                </a>
            </li>
        </ul>
        <form class="navbar-form navbar-left input-s-lg m-t m-l-n-xs hidden-xs" role="search">
            <div class="form-group">
                <div class="input-group">
            <span class="input-group-btn">
              <button type="submit" class="btn btn-sm bg-white btn-icon rounded"><i class="fa fa-search"></i></button>
            </span>
                    <input type="text" class="form-control input-sm no-border rounded"
                           placeholder="搜索本站">
                </div>
            </div>
        </form>
        <div class="navbar-right ">
            <ul class="nav navbar-nav m-n hidden-xs nav-user user">

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle bg clear" data-toggle="dropdown">
              <span class="thumb-sm avatar pull-right m-t-n-sm m-b-n-sm m-l-sm">
                <img src="images/a0.png" alt="...">
              </span>
                        <userNo></userNo>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu animated fadeInRight">
                        <li>
                            <a href="../logout">Logout</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </header>
    <section>
        <section class="hbox stretch">
            <!-- .aside -->
            <aside class="bg-black dk aside hidden-print" id="nav">
                <section class="vbox">
                    <section class="w-f-md scrollable">
                        <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0"
                             data-size="10px" data-railOpacity="0.2">


                            <!-- nav -->
                            <nav class="nav-primary hidden-xs">
                                <ul class="nav bg clearfix">
                                    <li class="hidden-nav-xs padder m-t m-b-sm text-xs text-muted">
                                        版块
                                    </li>
                                    <li>
                                        <a href="index.html" data-transition="pop">
                                            <i class="icon-home icon text-success"></i>
                                            <span class="font-bold">主页</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="internal.html" data-transition="pop">
                                            <i class="icon-grid icon text-info"></i>
                                            <span class="font-bold">内部组件</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="pcompTitle.html" data-transition="pop">
                                            <i class="icon-drawer icon text-primary-lter"></i>
                                            <span class="font-bold">开放软件</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-transition="pop">
                                            <i class="icon-list icon  text-info-dker"></i>
                                            <span class="font-bold">技术学院</span>
                                        </a>
                                    </li>
                                    <li class="m-b hidden-nav-xs"></li>
                                </ul>
                                <ul class="nav" data-ride="collapse">
                                    <li class="hidden-nav-xs padder m-t m-b-sm text-xs text-muted">
                                        <softwareProfile>

                                        </softwareProfile>

                                    </li>
                                    <li id="introduction" class="active">
                                        <a href="#">
                                            <i class="icon-film icon"></i>
                                            <span>软件介绍</span>
                                        </a>
                                    </li>
                                    <li id="history">
                                        <a href="#" class="auto">
                                            <span class="pull-right text-muted">
                                              <i class="fa fa-angle-left text"></i>
                                              <i class="fa fa-angle-down text-active"></i>
                                            </span>
                                            <i class="icon-screen-desktop icon">
                                            </i>
                                            <span>迭代历史</span>
                                        </a>

                                    </li>
                                    <li id="download">
                                        <a href="#" class="auto">
                                            <span class="pull-right text-muted">
                                              <i class="fa fa-angle-left text"></i>
                                              <i class="fa fa-angle-down text-active"></i>
                                            </span>
                                            <i class="icon-arrow-down icon">
                                            </i>
                                            <span>版本下载</span>
                                        </a>

                                    </li>
                                    <li id="quickstart">
                                        <a href="#" class="auto">
                                            <span class="pull-right text-muted">
                                              <i class="fa fa-angle-left text"></i>
                                              <i class="fa fa-angle-down text-active"></i>
                                            </span>
                                            <i class="icon-bulb icon">
                                            </i>
                                            <span>快速上手</span>
                                        </a>

                                    </li>
                                </ul>
                            </nav>
                            <!-- / nav -->
                        </div>
                    </section>

                </section>
            </aside>
            <!-- /.aside -->
            <section id="content">
                <section class="hbox stretch">
                    <section>
                        <section class="vbox">
                            <section class="scrollable padder-lg w-f-md" id="bjax-target">
                                <div>
                                    <a href="#" class="pull-right text-muted m-t-lg" id="editPcompSoftwareIntroduction">
                                        <button id="submitButton"
                                                class="btn btn-s-md btn-primary btn-rounded " style="display:none;">提交
                                        </button>

                                    </a>

                                    <h2 class="font-thin m-b" id="title">

                                    </h2>


                                    <div class="row row-sm" id="mdEditor">

                                        <div id="mdEditorReal">
                                            <textarea style="display:none;" id="mdEditorText"></textarea>
                                        </div>

                                    </div>
                                </div>
                            </section>
                        </section>

                    </section>
                    <!-- / side content -->
                </section>
                <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen,open"
                   data-target="#nav,html"></a>
            </section>


        </section>
    </section>
</section>
<input type="file" style="display: none" id="fakeFileInput" name="fakeFileInput">

<script src="js/jquery.min.js"></script>

<!-- Bootstrap -->
<script src="js/bootstrap.js"></script>
<!-- App -->
<script src="js/app.js"></script>
<script src="js/slimscroll/jquery.slimscroll.min.js"></script>
<script src="js/app.plugin.js"></script>
<script type="text/javascript" src="js/jPlayer/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="js/jPlayer/add-on/jplayer.playlist.min.js"></script>
<script type="text/javascript" src="js/jPlayer/demo.js"></script>

<script type="text/javascript" src="js/sfpp-native/util.js"></script>
<script type="text/javascript" src="js/sfpp-native/user.js"></script>
<script type="text/javascript" src="js/sfpp-native/pcomp.js"></script>
<script type="text/javascript" src="js/sfpp-native/pcompform.js"></script>
<script type="text/javascript" src="js/sfpp-native/search.js"></script>
<script type="text/javascript" src="js/editormd.min.js"></script>
<script src="js/jquery-form.js"></script>
<script src="lib/raphael.min.js"></script>
<script src="lib/underscore.min.js"></script>
<script src="lib/sequence-diagram.min.js"></script>
<script src="lib/flowchart.min.js"></script>
<script src="lib/jquery.flowchart.min.js"></script>
<script src="lib/prettify.min.js"></script>
<script src="lib/marked.min.js"></script>
<script src="plugins/jQueryUI/jquery-ui.min.js"></script>
<script src="plugins/bootstrap3-fileinput/js/fileinput.min.js"></script>

<script src="js/ajaxfileupload.js"></script>
<script>
    var pcompSoftwareId = getUrlParam("pcompSoftwareId");
    $(document).ready(function () {
        var mdEditorText;
        var button = $("#submitButton");
        var edit = $("i[class*=icon-pencil]");
//        页面初始化
        $("userNo").html(($.user.get()).userNo);
        var pcompSoftware;
        var pcompVersions;
        var title = $("#title");
        var allList;
        if ($.pcomp.userRight.getHasAddVersionRight(pcompSoftwareId)) {
            var button1 = $("<button class='btn btn-info btn-rounded'>添加新版本</button>");
            title.after(button1);
            button1.click(function () {
                var dialogDiv = $("[role=dialog]");
                var id = this.id;
                dialogDiv.remove();
                var dialog = $(dialog_str);
                dialog.attr("title", "添加版本");
                var label = $("<h4></h4>");
                label.html("所属软件：<b>" + pcompSoftware.name + "</b>");
                dialog.append(label);
                label = $(label_str);
                label.html("请输入新版本号（不为空）：");
                dialog.append(label);
                var versionNumber = $(pcomp_version_number_textInput_str);
                dialog.append(versionNumber);
                label = $(label_str);
                label.html("请输入本版本介绍：");
                dialog.append(label);
                var md = $(md_div);
                md.attr("id", "versionIntroduction");
                dialog.append(md);
                label = $(label_str);
                label.html("请输入本版本快速上手：");
                dialog.append(label);
                md = $(md_div);
                md.attr("id", "versionQuickstart");
                dialog.append(md);
                label = $(label_str);
                label.html("请上传本版本软件下载：");
                dialog.append(label);
                addline(label, 1);
                label = $(label_str);
                label.html("请上传本版本文档下载：");
                dialog.append(label);
                addline(label, 2);
                function addline(but, kind) {
                    var div = $("<div class='row'></div>");
                    var col = $("<div class='col-xs-12 col-sm-12 col-md-5 col-lg-5'></div>");
                    label = $(label_str);
                    col.append(label);
                    var softwareDescription = $(notNull_textInput_str);
                    if (kind == 1) {
                        label.html("<small>请输入软件描述：</small>");
                        softwareDescription.attr("name", "software_description");
                    } else if (kind == 2) {
                        label.html("<small>请输入文档描述：</small>");
                        softwareDescription.attr("name", "document_description");
                    }
                    col.append(softwareDescription);
                    div.append(col);
                    col = $("<div class='col-xs-12 col-sm-12 col-md-5 col-lg-5'></div>");
                    label = $(label_str);

                    col.append(label);
                    var softwareDownload = $(notNull_fileInput_str);
                    col.append(softwareDownload);
                    if (kind == 1) {
                        label.html("<small>请上传软件：</small>");
                        softwareDownload.attr("name", "pcomp_version_platform_download_download");
                    } else if (kind == 2) {
                        label.html("<small>请上传文档：</small>");
                        softwareDownload.attr("name", "pcomp_version_document_download_download");
                    }
                    softwareDownload.fileinput();
                    div.append(col);
                    col = $("<div class='col-xs-12 col-sm-12 col-md-2 col-lg-2'></div>");
                    var but1 = $("<button class='btn btn-success softwareline'>增加一行</button>");
                    col.append(but1);
                    var but2 = $("<button class='btn btn-danger softwareline'>删除一行</button>");
                    col.append(but2);
                    div.append(col);
                    but1.click(function () {
                        addline($(this).parent().parent(), kind)
                    });
                    but2.click(function () {
                        div.remove()
                    });
                    but.after(div);
                }

                dialog.dialog({
                    autoOpen: false,
                    minWidth: 800,
                    minHeight: 600,
                    maxHeight: 600,
//                    show: {effect: "blind", duration: 1000},
                    hide: {effect: "explode", duration: 1000},
                    modal: true,
                    buttons: {
                        "提交修改": function () {
                            if (validatePcomp()) {
                                $.pcomp.version.add(pcompSoftwareId, versionNumber[0].value, mdEditorText.getMarkdown(), mdEditorText2.getMarkdown(), $("input[name=software_description]").arrayVal(), $("input[name=document_description]").arrayVal(), initialize);
                                $(this).dialog("close");
                            }
                        },
                        "取消": function () {
                            $(this).dialog("close");
                        }
                    }
                });
                dialog.dialog("open");
                var mdEditorText = editormd("versionIntroduction", editorMdEditing);
                var mdEditorText2 = editormd("versionQuickstart", editorMdEditing);
            });
        }
        initialize();

        function initialize() {
            pcompSoftware = $.pcomp.software.getBySoftwareId(pcompSoftwareId);
            $("title").html(pcompSoftware.name);
            pcompVersions = pcompSoftware.pcompVersions;
            setPcompSoftwareProfile(pcompSoftware);
            if ($.pcomp.userRight.getHasModifySoftwareRight(pcompSoftwareId)) {
                button.next().remove();
                button.after($("<i class='icon-pencil i-lg '>编辑</i>"));
                edit = $("i[class*=icon-pencil]");
                edit.click(function () {
                    setMD(typeof(button.attr("style")) != "undefined", null);
                });
            } else {
                button.next().remove();
            }
            setMD(false, pcompSoftware.introduction);
            $("#history").find("li").remove();
            $("#history").append(getList("history"));
            $("#download").find("li").remove();
            $("#download").append(getList("download"));
            $("#quickstart").find("li").remove();
            $("#quickstart").append(getList("quickstart"));
            $("li[id^=history][id!=history]").click(function () {
                edit.attr("style", "");
                inactiveAllList();
                var id = this.id.substring(this.id.indexOf("history") + "history".length);
                $(this).parent().parent().attr("class", "active");
                var html = pcompSoftware.name + " - " + pcompVersions[id].versionNumber;
                if ($.pcomp.userRight.getHasModifyVersionRight(pcompVersions[getVersionId(this)].id)) {
                    html += "<button class='btn btn-success btn-rounded'>修改</button><button class='btn btn-danger btn-rounded'>删除</button>";
                    button.next().remove();
                    button.after($("<i class='icon-pencil i-lg '>编辑</i>"));
                    edit = $("i[class*=icon-pencil]");
                    edit.click(function () {
                        setMD(typeof(button.attr("style")) != "undefined", null);
                    });
                } else {
                    button.next().remove();
                }
                title.html(html);
                $("button[class*=btn-success][class*=btn-rounded]").click(function () {
                    var dialogDiv = $("[role=dialog]");
                    dialogDiv.remove();
                    var dialog = $(dialog_str);
                    dialog.attr("title", "添加版本");
                    var label = $("<h4></h4>");
                    label.html("所属软件：<b>" + pcompSoftware.name + "</b>");
                    dialog.append(label);
                    label = $(label_str);
                    label.html("请输入新版本号（不为空）：");
                    dialog.append(label);
                    var versionNumber = $(pcomp_version_number_textInput_str);
                    dialog.append(versionNumber);
                    dialog.dialog({
                        autoOpen: false,
                        minWidth: 400,
                        minHeight: 400,
                        show: {
                            effect: "blind",
                            duration: 1000
                        },
                        hide: {
                            effect: "explode",
                            duration: 1000
                        },
                        modal: true,
                        buttons: {
                            "提交修改": function () {
                                if (validatePcomp()) {
                                    $.pcomp.version.updateVersionNumber(pcompVersions[getVersionId()].id, versionNumber[0].value, initialize);
                                    $(this).dialog("close");
                                }
                            },
                            "取消": function () {
                                $(this).dialog("close");
                            }
                        }
                    });
                    dialog.dialog("open");
                });
                $("button[class*=btn-danger][class*=btn-rounded]").click(function () {
                    if (confirm("你确定要删除" + pcompSoftware.name + " - " + pcompVersions[id].versionNumber + "吗？")) {
                        $.pcomp.version.delete(pcompSoftwareId, pcompVersions[id].id, initialize);
                    }
                });
                setMD(false, pcompVersions[id].introduction);
            });
            $("li[id^=download][id!=download]").click(function () {
                edit.attr("style", "display:none");
                inactiveAllList();
                $(this).parent().parent().attr("class", "active");
                var id = this.id.substring(this.id.indexOf("download") + "download".length);
                var html = pcompSoftware.name + " - " + pcompVersions[id].versionNumber;
                title.html(html);
                setDownload(pcompVersions[id]);
            });
            $("li[id^=quickstart][id!=quickstart]").click(function () {
                edit.attr("style", "");
                inactiveAllList();
                $(this).parent().parent().attr("class", "active");
                var id = this.id.substring(this.id.indexOf("quickstart") + "quickstart".length);
                var html = pcompSoftware.name + " - " + pcompVersions[id].versionNumber;
                title.html(html);
                if ($.pcomp.userRight.getHasModifyVersionRight(pcompVersions[getVersionId(this)].id)) {
                    button.next().remove();
                    button.after($("<i class='icon-pencil i-lg '>编辑</i>"));
                    edit = $("i[class*=icon-pencil]");
                    edit.click(function () {
                        setMD(typeof(button.attr("style")) != "undefined", null);
                    });
                } else {
                    button.next().remove();
                }
                setMD(false, pcompVersions[id].quickStart);
            });
            allList = $("li");
            title.html(pcompSoftware.name);
        }

//        页面初始化结束

        var dialog = $("#dialog");
        var name = $("#name");
        var file = $("#file");
        var name_help = $("#name_help");
        var file_help = $("#file_help");
        var name_description = $("#name_description");
        var file_description = $("#file_description");

        $("#introduction").click(function () {
            edit.attr("style", "");
            title.html(pcompSoftware.name);
            if ($.pcomp.userRight.getHasModifySoftwareRight(pcompSoftwareId)) {
                button.next().remove();
                button.after($("<i class='icon-pencil i-lg '>编辑</i>"));
                edit = $("i[class*=icon-pencil]");
                edit.click(function () {
                    setMD(typeof(button.attr("style")) != "undefined", null);
                });
            } else {
                button.next().remove();
            }
            setMD(false, pcompSoftware.introduction);
        });


        function inactiveAllList() {
            for (i = 0; i < allList.length; i++) {
                $(allList[i]).removeClass("active");
            }
        }

        function getList(prefix) {
            var ul = $("<ul class='nav dk text-sm'></ul>");
            for (i = 0; i < pcompVersions.length; i++) {
                var li = $("<li></li>");
                li.attr("id", prefix + i);
                var a = $("<a class='auto'></a>");
                var ii = $("<i class='fa fa-angle-right text-xs'></i>");
                var span = $("<span></span>");
                span.html(pcompVersions[i].versionNumber);
                ul.append(li);
                li.append(a);
                a.append(ii);
                a.append(span);
            }
            return ul;
        }


        function setMD(isEditing, content) {
            var mdEditor = $("#mdEditor");
            var div = $("<div id='mdEditorReal'style='display: none'></div>");
            var textarea = $("<textarea style='none' id='mdEditorText'></textarea>");
            if (content == null) {
                textarea.html(mdEditorText.getMarkdown());
            } else {
                textarea.html(content);
            }
            div.append(textarea);
            mdEditor.empty();
            mdEditor.append(div);
            if (isEditing) {
                mdEditorText = editormd("mdEditorReal", editorMdEditing);
                button.removeAttr("style");
            } else {
                mdEditorText = editormd.markdownToHTML("mdEditorReal", editorMdViewing);
                button.attr("style", "display:none");
            }
            div.fadeIn(1000);
        }

        function setDownload(pcompVersion) {
            var mdEditor = $("#mdEditor");
            var div = $("<div class='markdown-body editormd-html-preview'style='display: none'></div>");
            var h2 = $("<h2>软件下载：</h2>");
            div.append(h2);
            if ($.pcomp.userRight.getHasModifyVersionRight(pcompVersion.id)) {
                var button = $("<button class='btn btn-primary software' id='addSoftware'>增加</button>");
                h2.append(button);
            }
            var table = $("<table></table>");
            div.append(table);
            var tbody = $("<tbody></tbody>");
            table.append(tbody);
            var pcompVersionPlatformDownloads = pcompVersion.pcompVersionPlatformDownloads;
            for (i = 0; i < pcompVersionPlatformDownloads.length; i++) {
                var tr = $("<tr></tr>");
                var td = $("<td></td>");
                td.html(pcompVersionPlatformDownloads[i].platform);
                tr.append(td);
                td = $("<td></td>");
                var a = $("<a></a>");
                a.attr("href", pcompVersionPlatformDownloads[i].download);
                a.html("点我下载");
                td.append(a);
                tr.append(td);
                if ($.pcomp.userRight.getHasModifyVersionRight(pcompVersion.id)) {
                    td = $("<td><button class='btn btn-success software'id='" + i + "' >修改</button><button class='btn btn-danger software' id='" + i + "'>删除</button></td>");
                    tr.append(td);
                }
                tbody.append(tr);
            }
            var h2 = $("<h2>文档下载：</h2>");
            div.append(h2);
            if ($.pcomp.userRight.getHasModifyVersionRight( pcompVersion.id)) {
                var button = $("<button class='btn btn-primary document' id='addDocument'>增加</button>");
                h2.append(button);
            }
            table = $("<table></table>");
            div.append(table);
            tbody = $("<tbody></tbody>");
            table.append(tbody);
            var pcompVersionDocumentDownloads = pcompVersion.pcompVersionDoucumentDownloads;
            for (i = 0; i < pcompVersionDocumentDownloads.length; i++) {
                var tr = $("<tr></tr>");
                var td = $("<td></td>");
                td.html(pcompVersionDocumentDownloads[i].description);
                tr.append(td);
                td = $("<td></td>");
                var a = $("<a></a>");
                a.attr("href", pcompVersionDocumentDownloads[i].download);
                a.html("点我下载");
                td.append(a);
                tr.append(td);
                if ($.pcomp.userRight.getHasModifyVersionRight( pcompVersion.id)) {
                    td = $("<td><button class='btn btn-success document'id='" + i + "'>修改</button><button class='btn btn-danger document'id='" + i + "' >删除</button></td>");
                    tr.append(td);
                }
                tbody.append(tr);
            }
            mdEditor.empty();
            mdEditor.append(div);
            div.fadeIn(1000);
            $("button[class*=btn][class*=btn-primary][class*=software]").click(function () {
                var dialogDiv = $("[role=dialog]");
                dialogDiv.remove();
                var dialog = $(dialog_str);
                dialog.attr("title", "增加新软件下载");
                var label = $(label_str);
                label.html("新的软件描述：");
                dialog.append(label);
                var notNullText = $(notNull_textInput_str);
                dialog.append(notNullText);
                label = $(label_str);
                label.html("新的软件下载：");
                dialog.append(label);
                var notNullFile = $(notNull_fileInput_str);
                notNullFile.attr("name", "pcomp_version_platform_download_download");
                notNullFile.attr("id", "file");
                dialog.append(notNullFile);
                notNullFile.fileinput();
                dialog.dialog({
                    autoOpen: false,
                    minWidth: 400,
                    minHeight: 400,
                    show: {
                        effect: "blind",
                        duration: 1000
                    },
                    hide: {
                        effect: "explode",
                        duration: 1000
                    },
                    modal: true,
                    buttons: {
                        "提交修改": function () {
                            if (validatePcomp()) {
                                $.pcomp.version.newSoftwareDownload(pcompVersion.id, notNullText[0].value, initialize);
                                $(this).dialog("close");
                            }
                        },
                        "取消": function () {
                            $(this).dialog("close");
                        }
                    }
                });
                dialog.dialog("open");
            });
            $("button[class*=btn][class*=btn-primary][class*=document]").click(function () {
                var dialogDiv = $("[role=dialog]");
                dialogDiv.remove();
                var dialog = $(dialog_str);
                dialog.attr("title", "增加新文档下载");
                var label = $(label_str);
                label.html("新的文档描述：");
                dialog.append(label);
                var notNullText = $(notNull_textInput_str);
                dialog.append(notNullText);
                label = $(label_str);
                label.html("新的文档下载：");
                dialog.append(label);
                var notNullFile = $(notNull_fileInput_str);
                notNullFile.attr("name", "pcomp_version_document_download_download");
                notNullFile.attr("id", "file");
                dialog.append(notNullFile);
                notNullFile.fileinput();
                dialog.dialog({
                    autoOpen: false,
                    minWidth: 400,
                    minHeight: 400,
                    show: {
                        effect: "blind",
                        duration: 1000
                    },
                    hide: {
                        effect: "explode",
                        duration: 1000
                    },
                    modal: true,
                    buttons: {
                        "提交修改": function () {
                            if (validatePcomp()) {
                                $.pcomp.version.newDocumentDownload(pcompVersion.id, notNullText[0].value, initialize);
                                $(this).dialog("close");
                            }
                        },
                        "取消": function () {
                            $(this).dialog("close");
                        }
                    }
                });
                dialog.dialog("open");
            });
            $("button[class*=btn][class*=btn-success][class*=software]").click(function () {
                var dialogDiv = $("[role=dialog]");
                dialogDiv.remove();
                var id = this.id;
                var dialog = $(dialog_str);
                dialog.attr("title", "修改软件下载");
                var label = $(label_str);
                label.html("新的软件描述：");
                dialog.append(label);
                var notNullText = $(notNull_textInput_str);
                notNullText.attr("value", pcompVersions[getVersionId()].pcompVersionPlatformDownloads[id].platform);
                dialog.append(notNullText);
                label = $(label_str);
                label.html("新的软件下载（留空为不修改）：");
                dialog.append(label);
                var file = $(fileInput_str);
                file.attr("name", "pcomp_version_platform_download_download");
                file.attr("id", "file");
                dialog.append(file);
                file.fileinput();
                dialog.dialog({
                    autoOpen: false,
                    minWidth: 400,
                    minHeight: 400,
                    show: {
                        effect: "blind",
                        duration: 1000
                    },
                    hide: {
                        effect: "explode",
                        duration: 1000
                    },
                    modal: true,
                    buttons: {
                        "提交修改": function () {
                            if (validatePcomp()) {
                                $.pcomp.version.modifySoftwareDownload(pcompVersions[getVersionId()].id, pcompVersions[getVersionId()].pcompVersionPlatformDownloads[id].id, notNullText[0].value, initialize);
                                $(this).dialog("close");
                            }
                        },
                        "取消": function () {
                            $(this).dialog("close");
                        }
                    }
                });
                dialog.dialog("open");
            });
            $("button[class*=btn][class*=btn-success][class*=document]").click(function () {
                var dialogDiv = $("[role=dialog]");
                dialogDiv.remove();
                var id = this.id;
                var dialog = $(dialog_str);
                dialog.attr("title", "修改文档下载");
                var label = $(label_str);
                label.html("新的文档描述：");
                dialog.append(label);
                var notNullText = $(notNull_textInput_str);
                notNullText.attr("value", pcompVersions[getVersionId()].pcompVersionDoucumentDownloads[id].description);
                dialog.append(notNullText);
                label = $(label_str);
                label.html("新的文档下载（留空为不修改）：");
                dialog.append(label);
                var file = $(fileInput_str);
                file.attr("name", "pcomp_version_document_download_download");
                file.attr("id", "file");
                dialog.append(file);
                file.fileinput();
                dialog.dialog({
                    autoOpen: false,
                    minWidth: 400,
                    minHeight: 400,
                    show: {
                        effect: "blind",
                        duration: 1000
                    },
                    hide: {
                        effect: "explode",
                        duration: 1000
                    },
                    modal: true,
                    buttons: {
                        "提交修改": function () {
                            if (validatePcomp()) {
                                $.pcomp.version.modifyDocumentDownload(pcompVersions[getVersionId()].id, pcompVersions[getVersionId()].pcompVersionDoucumentDownloads[id].id, notNullText[0].value, initialize);
                                $(this).dialog("close");
                            }
                        },
                        "取消": function () {
                            $(this).dialog("close");
                        }
                    }
                });
                dialog.dialog("open");
            });
            $("button[class*=btn][class*=btn-danger][class*=software]").click(function () {
                if (confirm("你确定要删除" + pcompVersions[getVersionId()].pcompVersionPlatformDownloads[this.id].platform + "吗？")) {
                    $.pcomp.version.deleteSoftwareDownload(pcompSoftwareId, pcompVersions[getVersionId()].id, pcompVersions[getVersionId()].pcompVersionPlatformDownloads[this.id].id, initialize);
                }
            });
            $("button[class*=btn][class*=btn-danger][class*=document]").click(function () {
                if (confirm("你确定要删除" + pcompVersions[getVersionId()].pcompVersionDoucumentDownloads[this.id].description + "吗？")) {
                    $.pcomp.version.deleteDocumentDownload(pcompSoftwareId, pcompVersions[getVersionId()].id, pcompVersions[getVersionId()].pcompVersionDoucumentDownloads[this.id].id, initialize);
                }
            });
        }


        function setPcompSoftwareProfile() {
            pcompSoftware = $.pcomp.software.getBySoftwareId(pcompSoftwareId);
            $("softwareProfile").html("<img src=\"" + pcompSoftware.avatar + "\" style=\"width: 100%;max-width: 55px;height: auto;border-radius: 50%;padding: 5px\"><b style=\"padding: 5px\">" + pcompSoftware.name + "</b>");
            if ($.pcomp.userRight.getHasModifySoftwareRight(pcompSoftwareId)) {
                $("softwareProfile").append($("<button type='button' class='btn btn-box-tool edit'><i class='fa fa-pencil'></i></button><button type='button' class='btn btn-box-tool delete' ><i class=\"fa fa-trash\"></i></button>"));
            }
            $("button[class*=btn][class*=btn-box-tool][class*=edit]").click(function () {
                var dialogDiv = $("[role=dialog]");
                dialogDiv.remove();
                var id = this.id;
                var dialog = $(dialog_str);
                dialog.attr("title", "修改软件信息");
                var label = $(label_str);
                label.html("新的软件名称：");
                dialog.append(label);
                var notNullText = $(notNull_textInput_str);
                notNullText.attr("value", pcompSoftware.name);
                dialog.append(notNullText);
                label = $(label_str);
                label.html("新的软件头像（留空则为不修改）：");
                dialog.append(label);
                var file = $(fileInput_str);
                file.attr("name", "pcomp_software_avatar");
                file.attr("id", "file");
                dialog.append(file);
                file.fileinput();
                dialog.dialog({
                    autoOpen: false,
                    minWidth: 400,
                    minHeight: 400,
                    show: {
                        effect: "blind",
                        duration: 1000
                    },
                    hide: {
                        effect: "explode",
                        duration: 1000
                    },
                    modal: true,
                    buttons: {
                        "提交修改": function () {
                            if (validatePcomp()) {
                                $.pcomp.software.updateSoftwareAvatar(pcompSoftwareId, notNullText[0].value, initialize);
                                $(this).dialog("close");
                            }
                        },
                        "取消": function () {
                            $(this).dialog("close");
                        }
                    }
                });
                dialog.dialog("open");
            });

            $("button[class*=btn][class*=btn-box-tool][class*=delete]").click(function () {
                if (confirm("你确定要删除" + pcompSoftware.name + "吗？")) {
                    $.pcomp.software.delete(pcompSoftware.pcompKindId, pcompSoftware.id);
                }
            });
        }

        $("button[class*=btn][class*=btn-primary][class*=btn-rounded]").click(function () {
            var a = getCurrentContext();
            if (a == "introduction") {
                pcompSoftware.introduction = mdEditorText.getMarkdown();
                $.pcomp.software.updateSoftwareIntroduction(pcompSoftwareId, mdEditorText.getMarkdown());
            } else if (a == "history") {
                var versionId = getVersionId();
                pcompVersions[versionId].introduction = mdEditorText.getMarkdown();
                $.pcomp.version.updateIntroduction(pcompVersions[versionId].id, mdEditorText.getMarkdown());
            } else if (a == "quickstart") {
                var versionId = getVersionId();
                pcompVersions[versionId].quickStart = mdEditorText.getMarkdown();
                $.pcomp.version.updateQuickStart(pcompVersions[versionId].id, mdEditorText.getMarkdown());
            }
            setMD(false, null);
        });
        //true为software，false为version
        function getCurrentContext() {
            if ($("#introduction[class^=active]").length != 0) {
                return "introduction";
            } else if ($("#history[class^=active]").length != 0) {
                return "history";
            } else if ($("#download[class^=active]").length != 0) {
                return "download";
            } else if ($("#quickstart[class^=active]").length != 0) {
                return "quickstart";
            }
        }

        function getVersionId(para) {
            var id;
            if ($("#history[class^=active]").length != 0) {
                if (isNull(para)) {
                    id = $("li[id^=history][class^=active][id!=history]")[0].id;
                } else {
                    id = para.id;
                }
                id = id.substring(id.indexOf("history") + "history".length);
            } else if ($("#download[class^=active]").length != 0) {
                if (isNull(para)) {
                    id = $("li[id^=download][class^=active][id!=download]")[0].id;
                } else {
                    id = para.id;
                }
                id = id.substring(id.indexOf("download") + "download".length);
            } else if ($("#quickstart[class^=active]").length != 0) {
                if (isNull(para)) {
                    id = $("li[id^=quickstart][class^=active][id!=quickstart]")[0].id;
                } else {
                    id = para.id;
                }
                id = id.substring(id.indexOf("quickstart") + "quickstart".length);
            }
            return id;
        }
    });
</script>
</body>
</html>